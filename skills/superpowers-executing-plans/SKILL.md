---
name: superpowers-executing-plans
description: |
  自主计划执行技能，支持两种执行模式：
  1. Subagent-driven: 每个任务由子 agent 执行，两阶段审查
  2. Batch execution: 批量执行带人工检查点
  
  **核心功能:**
  - 任务分发和执行
  - 两阶段审查（规范符合性 → 代码质量）
  - 阻塞关键问题防止继续
  
  **触发条件:**
  - 实施计划已创建完成
  - 需要自主执行复杂任务
  
  **激活方式:**
  - 命令: `/superpowers:execute-plan`
  - 上下文: 计划编写完成后自动触发
---

# Superpowers: Executing Plans Skill

## Overview

这是一个自主计划执行技能，支持两种执行模式：
1. **Subagent-driven Development**: 为每个任务创建子 agent 执行
2. **Batch Execution**: 批量执行，定期等待人工确认

## Core Philosophy

**"自主但受控的执行"**

- 能自主工作数小时
- 但不会偏离计划
- 定期检查质量和进度
- 阻塞问题不会忽略

## Execution Modes

### Mode 1: Subagent-Driven Development

每个任务由独立子 agent 执行：

```markdown
## Subagent-Driven 模式

**工作流程:**

1. **任务调度**
   - 从计划中取出下一个任务
   - 创建独立的执行上下文
   - 启动子 agent

2. **子 agent 执行**
   - 接收任务详情和约束
   - 执行详细步骤
   - 生成代码和测试

3. **两阶段审查**
   
   **阶段1: 规范符合性**
   - [ ] 代码实现了所有要求
   - [ ] 文件路径正确
   - [ ] 接口签名正确
   - [ ] 功能行为符合预期
   
   **阶段2: 代码质量**
   - [ ] 代码风格一致
   - [ ] 无明显代码异味
   - [ ] 适当的错误处理
   - [ ] 测试覆盖关键逻辑

4. **审查结果**
   
   **通过:**
   - 合并代码
   - 标记任务完成
   - 继续下一个任务
   
   **需要修改:**
   - 返回给子 agent
   - 明确修改要求
   - 重新执行
   
   **阻塞:**
   - 暂停执行
   - 报告问题
   - 等待人工干预
```

### Mode 2: Batch Execution

批量执行带检查点：

```markdown
## Batch Execution 模式

**工作流程:**

1. **配置批次**
   - 每 N 个任务后暂停
   - 或每 M 分钟后暂停
   - 定义检查点内容

2. **批次执行**
   - 执行一批任务
   - 收集结果和指标
   - 记录问题和决策

3. **检查点报告**
   
   ```markdown
   ## 📍 检查点报告
   
   **批次:** 1/3
   **时间:** [timestamp]
   **已完成:** 5/15 任务
   
   ### 完成的任务
   - [x] Task 1.1
   - [x] Task 1.2
   - [x] Task 1.3
   - [x] Task 1.4
   - [x] Task 1.5
   
   ### 发现的问题
   - ⚠️ Task 1.3 涉及 API 变更，需要前端配合
   - ⚠️ Task 1.5 的测试覆盖率不足
   
   ### 性能指标
   - 平均任务时长: 4.2分钟
   - 一次通过率: 80%
   
   **是否继续执行批次 2/3？**
   - [继续]
   - [暂停，需要人工确认]
   ```
```

## Task Execution Flow

### 执行前准备

```markdown
## 🚀 执行准备

**计划:** [计划名称]
**任务数:** [N] 个
**预计时长:** [时间]

### 环境检查
- [ ] Node.js 版本正确
- [ ] 依赖已安装
- [ ] 数据库已配置
- [ ] 测试环境就绪

### 资源分配
- 主上下文: 当前会话
- 子 agent: 按需创建
- 并发数: [N]

### 回退计划
- Git 分支: feature/[任务名]
- 回退命令: `git checkout HEAD~1`
```

### 执行单个任务

```markdown
## 执行 Task [编号]: [任务名称]

### 任务信息
- 预计时长: [N]分钟
- 优先级: [P0/P1/P2]
- 依赖: [Task X]

### 执行步骤

1. **准备环境**
   ```bash
   git checkout -b feature/task-[编号]
   ```

2. **实施变更**
   [应用详细步骤中的代码]

3. **运行验证**
   ```bash
   npm test -- --grep "task-[编号]"
   ```

4. **代码审查**
   [自动执行两阶段审查]

### 执行结果

**状态:** ✅ 完成 / ⚠️ 需要修改 / ❌ 阻塞

**实际耗时:** [N]分钟

**输出:**
- 文件: [列表]
- 测试: [结果]
- 文档: [更新]

### 下一任务
- Task [编号+1]: [名称]
```

## Two-Stage Review Process

### Stage 1: 规范符合性

```markdown
## 🔍 阶段1: 规范符合性审查

### 检查清单

**功能正确性**
- [ ] 所有必需功能已实现
- [ ] 无额外功能（YAGNI）
- [ ] 边界条件已处理
- [ ] 错误情况已处理

**接口正确性**
- [ ] 文件路径符合要求
- [ ] 函数签名正确
- [ ] 参数类型正确
- [ ] 返回值正确

**行为正确性**
- [ ] 符合设计规格
- [ ] 符合用户故事
- [ ] 符合验收标准

**数据正确性**
- [ ] 数据格式正确
- [ ] 数据验证正确
- [ ] 数据持久化正确

### 审查结果

**通过标准:** 所有检查项必须通过

**结果:** ✅ 通过 / ❌ 不通过

**反馈:**
[具体的改进建议]
```

### Stage 2: 代码质量审查

```markdown
## 🔍 阶段2: 代码质量审查

### 检查清单

**代码风格**
- [ ] 遵循项目编码规范
- [ ] 命名一致且有意义
- [ ] 代码格式正确
- [ ] 注释恰当

**代码结构**
- [ ] 函数单一职责
- [ ] 类/模块划分合理
- [ ] 无重复代码（DRY）
- [ ] 适当的抽象

**代码质量**
- [ ] 无明显代码异味
- [ ] 复杂度适中
- [ ] 错误处理恰当
- [ ] 资源管理正确

**测试质量**
- [ ] 测试覆盖关键路径
- [ ] 测试命名清晰
- [ ] 测试独立不耦合
- [ ] 断言有意义

**安全性**
- [ ] 无硬编码密钥
- [ ] 输入已验证
- [ ] 权限检查正确
- [ ] 敏感数据保护

### 代码质量评分

- **可读性:** [1-5]
- **可维护性:** [1-5]
- **可靠性:** [1-5]
- **安全性:** [1-5]

**综合评分:** [平均分]/5

### 改进建议

**必须修复:**
1. [问题1]
2. [问题2]

**建议修复:**
1. [问题3]
2. [问题4]

**可选优化:**
1. [优化1]
2. [优化2]
```

## Progress Tracking

### 实时进度

```markdown
## 📊 执行进度

**开始时间:** [timestamp]
**当前时间:** [timestamp]
**已用时间:** [时长]

**总体进度:** [M]/[N] 任务 ([百分比]%)

### 各阶段进度

| 阶段 | 完成/总数 | 状态 |
|------|-----------|------|
| Phase 1 | 5/5 | ✅ 完成 |
| Phase 2 | 3/8 | 🔄 进行中 |
| Phase 3 | 0/3 | ⏳ 等待 |

### 性能指标

- 平均任务时长: [时间]
- 一次通过率: [百分比]
- 审查通过率: [百分比]
- 阻塞次数: [N]次

### 当前任务

**Task [编号]: [名称]**
- 开始时间: [timestamp]
- 已用时间: [时间]
- 状态: [进行中/审查中/完成]
```

### 异常处理

```markdown
## ⚠️ 异常情况

### 任务阻塞
**Task:** [编号] - [名称]
**原因:** [描述]
**影响:** [影响范围]

**建议:**
1. [处理方案1]
2. [处理方案2]

### 错误记录
**时间:** [timestamp]
**错误:** [描述]
**堆栈:** ```
[堆栈跟踪]
```

**处理:**
- [x] 已记录到 progress.md
- [x] 已尝试修复
- [ ] 需要人工介入

### 计划变更
**变更:** [描述]
**原因:** [原因]
**影响:** [影响分析]

**审批状态:** 待审批 / 已批准
```

## Output Format

### 执行报告

```markdown
## 📋 执行报告

**计划:** [名称]
**执行时间:** [开始] - [结束]
**总耗时:** [时长]

### 执行摘要

| 指标 | 数值 |
|------|------|
| 总任务数 | [N] |
| 完成 | [N] |
| 跳过 | [N] |
| 阻塞 | [N] |
| 失败 | [N] |

### 完成的任务

#### Phase 1: [名称]
- [x] Task 1.1: [名称] ([时间])
- [x] Task 1.2: [名称] ([时间])
- [x] Task 1.3: [名称] ([时间])

#### Phase 2: [名称]
- [x] Task 2.1: [名称] ([时间])
- [x] Task 2.2: [名称] ([时间])
- [ ] Task 2.3: 阻塞

### 阻塞的任务

**Task 2.3:** [名称]
**阻塞原因:** [描述]
**建议解决方案:** [方案]

### 代码变更

- 新增文件: [N] 个
- 修改文件: [N] 个
- 删除文件: [N] 个
- 代码行数: +[N]/-[N]

### 测试结果

- 测试用例: [N] 个
- 通过: [N] 个
- 失败: [N] 个
- 覆盖率: [百分比]

### 质量评估

- 规范符合性: [百分比]
- 代码质量: [平均分]/5
- 技术债务: [低/中/高]

### 建议

1. [建议1]
2. [建议2]
3. [建议3]
```

## Trigger Conditions

### 自动触发
- 计划已创建完成
- 批量执行检查点到达
- 子 agent 任务完成

### 手动触发
- `/superpowers:execute-plan` - 开始执行
- `/superpowers:execute-plan:batch` - 批量模式
- `/superpowers:execute-plan:subagent` - 子 agent 模式
- `/superpowers:execute-plan:pause` - 暂停执行
- `/superpowers:execute-plan:resume` - 继续执行
- `/superpowers:execute-plan:status` - 查看状态

## Configuration

```json
{
  "execution": {
    "mode": "batch", // 或 "subagent"
    "batchSize": 5,
    "batchTimeout": 30, // 分钟
    "autoReview": true,
    "parallelAgents": 2,
    "reviewStrictness": "normal" // 或 "strict", "relaxed"
  },
  "review": {
    "autoApproveThreshold": 4.5,
    "requireHumanForBlocking": true,
    "qualityGate": {
      "minScore": 3.5,
      "maxDebt": "medium"
    }
  }
}
```

## Integration

### 与 Writing Plans 配合
- 输入: 详细的任务清单
- 输出: 执行结果和指标

### 与 Brainstorming 配合
- 执行中遇到设计问题可触发
- 重大变更需要重新设计

### 与 Planning with Files 配合
- 自动更新 progress.md
- 错误记录到 findings.md
- 阶段完成更新 task_plan.md

### 与 Code Review 配合
- 集成代码审查结果
- 问题反馈到执行流程

## Best Practices

### 1. 渐进式执行
- 先执行少量任务验证计划
- 根据反馈调整后续执行
- 保持灵活但遵循计划

### 2. 严格审查
- 不要跳过审查步骤
- 质量问题必须修复
- 安全问题不能妥协

### 3. 及时沟通
- 阻塞立即报告
- 重大变更及时同步
- 进度定期更新

### 4. 记录决策
- 所有决策要记录
- 原因和权衡要清楚
- 便于后续回顾

## Success Metrics

- ✅ 计划执行完成率 > 95%
- ✅ 一次通过率 > 80%
- ✅ 平均任务时长接近估算
- ✅ 阻塞率 < 10%
- ✅ 质量评分 > 4.0/5
